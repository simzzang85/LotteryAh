global.NSP=METHOD(function(e){var t,n,r,o=require("path"),i={},s=SHARED_STORE("__NSP_SHARED_STORE");return e.getSavedCodes=t=function(){return i},e.getSharedStore=n=function(){return s},e.generateErrorDisplay=r=function(e){var t="";return t+="<p><b>"+e.error+"</b></p>",t+="<p><b>path: </b>"+e.path+" ("+e.startLine+":"+e.startColumn+"~"+e.endLine+":"+e.endColumn+")</p>",t+="<pre>"+i[e.path].substring(e.startIndex,e.endIndex)+"</pre>"},e.require=require,{run:function(e){var t,n,r,s,a,u,_,c,f,p=e.path,d=e.code,l=e.isNotUsingDCBN,h=e.preprocessor,m="",S=0,E=0,v=1,C=1,I=0,g=0,T=[0],R=!1,N=!1,P=!1,L=!1,x=!1,A=!1,U=!1,b=!1,H=!1,D=function(){return R===!0||P===!0||L===!0||x===!0},y=function(){return A===!0||U===!0||b===!0||H===!0},k=function(){T[T.length-1]+=1,m+="__pauseCount += 1;",m+="__store.resume = resume = function() { __pauseCount -= 1; if (__pauseCount === 0 && __store.doneResumeIndexes["+S+"] !== true) { __store.doneResumeIndexes["+S+"] = true;"},O=function(e){m+="var __pauseCount = 0;",m+="var __lastCondition;",m+="var __store = { doneResumeIndexes: {} };",m+="var resume;",m+="var pause = "+function(){__pauseCount+=1}.toString()+";",m+="var include = "+function(e){LOAD_NSP({requestInfo:__requestInfo,path:__basePath+"/"+e,self:self},{notExists:function(){print(e+": File not exists."),resume()},error:function(e,t,n,r,o,i,s,a){print(NSP.generateErrorDisplay({path:t,startIndex:s,endIndex:a,startLine:n,startColumn:r,endLine:o,endColumn:i,error:e}))},success:function(e){print(e.html),resume()}}),pause()}.toString()+";",e===!0?m+="__store.resume = resume = function() { __pauseCount -= 1; };":k()};for(i[p]=d,RUN(function(){m+="var __html = '';",m+="var __redirectURL;",m+="var __cookieInfo = __requestInfo.cookies;",m+="var __newCookieInfo = {};",m+="var __basePath = '"+o.dirname(p)+"';",m+="var print = "+function(e){void 0!==e&&("string"==typeof e?__html+=e:__html+=JSON.stringify(e))}.toString()+";",m+="var save = "+function(e,t){void 0===t?NSP.getSharedStore().remove(e):NSP.getSharedStore().save({name:e,value:t})}.toString()+";",m+="var load = "+function(e){return NSP.getSharedStore().get(e)}.toString()+";",m+="var cookie = "+function(e,t,n,r,o){return void 0===t?(t=__cookieInfo[e],CHECK_IS_DATA(t)===!0?t.value:t):(__newCookieInfo[e]=__cookieInfo[e]={value:t,expireSeconds:n,path:r,domain:o},t)}.toString()+";",m+="var upload = "+function(e,t){var n,r,o;CHECK_IS_DATA(t)!==!0?n=t:(n=t.success,r=t.error,o=t.overFileSize),UPLOAD_REQUEST({requestInfo:__requestInfo,uploadPath:__basePath+"/"+e},{error:r,overFileSize:o,success:n})}.toString()+";",m+="var redirect = "+function(e){__redirectURL=e,__handler({cookies:__newCookieInfo,redirectURL:__redirectURL})}.toString()+";",m+="var __each = "+function(e,t){isNaN(e)===!0?EACH(e,function(e,n){t(n,e)}):REPEAT(e,function(e){t(void 0,e)})}.toString()+";",O(!0),m+="print('"});S<d.length;S+=1)if(I+=1,s=d[S],a=s+d[S+1],"<%"!==a||D()===!0)if("%>"!==a||y()===!0||R!==!0)if("<?"!==a||D()===!0)if("<~"!==a||D()===!0)if("->"!==a||y()===!0||L!==!0)if(":"!==s||y()===!0||L!==!0)if("el"!==a||"s"!==d[S+2]||"e"!==d[S+3]||" "!==d[S+4]&&"	"!==d[S+4]&&">"!==d[S+4]&&"\r"!==d[S+4]&&"\n"!==d[S+4]||y()===!0||P!==!0){if(">"===s&&y()!==!0){if(P===!0){P=!1,T.push(0),m+=") === true) { (function(__parentPause, __parentStore) {",O(),m+="print('";continue}if(L===!0){L=!1,T.push(0),-1===r&&(m+=", function(__name, __value"),m+=") { (function(__parentPause, __parentStore) {",O(),m+="print('";continue}}if("</"===a&&">"===d[S+3]&&D()!==!0){if("?"===d[S+2]){m+="');",REPEAT(T[T.length-1],function(e){0===e&&(m+="__parentStore.resume();"),m+="} }; resume();"}),T.pop(),m+="__parentPause(); } )(pause, __store); } } catch(e) { __errorHandler(e, __path, "+C+", "+g+", "+v+", "+(I+3)+", "+E+", "+(S+4)+"); }",k(),m+="print('",S+=3,I+=3;continue}if("~"===d[S+2]){m+="');",REPEAT(T[T.length-1],function(e){0===e&&(m+="__parentStore.resume();"),m+="} }; resume();"}),T.pop(),m+="__parentPause(); } )(pause, __store); } ); } catch(e) { __errorHandler(e, __path, "+C+", "+g+", "+v+", "+(I+3)+", "+E+", "+(S+4)+"); }",k(),m+="print('",S+=3,I+=3;continue}}if(l===!0||"{{"!==a||D()===!0)if(l===!0||"}}"!==a||y()===!0||x!==!0){if("'"===s){if(D()!==!0){m+="\\'";continue}if(y()!==!0){A=!0,m+="'";continue}if(A===!0){A=!1,m+="'";continue}}if('"'===s&&D()===!0){if(y()!==!0){U=!0,m+="'";continue}if(U===!0){U=!1,m+="'";continue}}if("//"!==a||D()!==!0||y()===!0)if("/*"!==a||D()!==!0||y()===!0)if("*/"!==a||D()!==!0||H!==!0){if("\n"===s){if(v+=1,I=0,D()===!0&&b===!0){b=!1,m+="\n";continue}if(D()!==!0){m+="\\n";continue}}"\\"!==s||D()===!0?"\r"!==s&&(m+=s):m+="\\\\"}else H=!1,m+="*/",S+=1,I+=1;else H=!0,m+="/*",S+=1,I+=1;else b=!0,m+="//",S+=1,I+=1}else x=!1,m+="); } catch(e) { __errorHandler(e, __path, "+C+", "+g+", "+v+", "+(I+1)+", "+E+", "+(S+2)+"); }",k(),m+="print('",S+=1,I+=1;else x=!0,m+="'); try { print(",C=v,g=I,E=S,S+=1,I+=1}else m+="__lastCondition !== true",S+=3,I+=3;else m+=", ";else for(m+=", function(",S+=1,I+=1,r=S+1;r<d.length;r+=1){if(">"===d[r]){m+="__name, ";break}if(":"===d[r])break}else L=!0,m+="'); try { __each(",C=v,g=I,E=S,S+=1,r=-1,I+=1;else P=!0,m+="'); try { if (__lastCondition = (",C=v,g=I,E=S,S+=1,I+=1;else R=!1,N===!0&&(N=!1,m+=");"),void 0===n?(n=S+2,_=v,f=I+1):m+="} catch(e) { __errorHandler(e, __path, "+C+", "+g+", "+v+", "+(I+1)+", "+E+", "+(S+2)+"); }",k(),m+="print('",S+=1,I+=1;else R=!0,C=v,g=I,E=S,void 0===t?(t=S,u=v,c=I,m+="');"):m+="'); try {","="===d[S+2]?(N=!0,m+="print(",S+=2,I+=2):(S+=1,I+=1);return m+="'); __handler({ html: __html, cookies: __newCookieInfo });",REPEAT(T[0],function(){m+="} }; resume();"}),void 0!==h&&(m=h(m)),void 0!==t&&(m="try {"+m+"} catch(e) { __errorHandler(e, __path, "+u+", "+c+", "+_+", "+f+", "+t+", "+n+"); }"),m="var __path = '"+p+"';"+m,m="var require = NSP.require;"+m}}}),global.LOAD_NSP=METHOD(function(e){var t={};return{run:function(e,n){var r=e.requestInfo,o=e.path,i=e.self,s=e.isNotUsingDCBN,a=e.preprocessor,u=n.notExists,_=n.error,c=n.success;GET_FILE_INFO(o,{notExists:u,success:function(e){var n=t[o];void 0!==n&&(void 0!==e.lastUpdateTime&&n.lastUpdateTime.getTime()===e.lastUpdateTime.getTime()||void 0!==e.createTime&&n.lastUpdateTime.getTime()===e.createTime.getTime())?n.run(r,i,_,c):READ_FILE(o,{notExists:u,error:_,success:function(n){var u=new Function("__requestInfo","self","__errorHandler","__handler",NSP({path:o,code:n.toString(),isNotUsingDCBN:s,preprocessor:a}));t[o]={lastUpdateTime:void 0===e.lastUpdateTime?e.createTime:e.lastUpdateTime,run:u},u(r,i,_,c)}})}})}}}),global.NSP_BRIDGE=METHOD(function(e){var t=require("path"),n=function(e,t,n,r,o,i,s,a,u){e({statusCode:500,content:'<!doctype html><html><head><meta charset="UTF-8"><title>'+t+"</title></head><body>"+NSP.generateErrorDisplay({path:n,startIndex:a,endIndex:u,startLine:r,startColumn:o,endLine:i,endColumn:s,error:t})+"</body></html>",contentType:"text/html"})},r=function(e){e({statusCode:404,content:'<!doctype html><html><head><meta charset="UTF-8"><title>Page not found.</title></head><body><p><b>Page not found.</b></p></body></html>',contentType:"text/html"})};return{run:function(e){var o=e.rootPath,i=e.restURI,s=e.isNotUsingDCBN,a=e.preprocessor,u=e.templateEngine;return{notExistsHandler:function(e,t,n){r(n)},requestListener:function(e,_,c,f,p){var d,l,h=e.uri,m="",S=function(){LOAD_NSP({requestInfo:e,path:d,self:{headers:e.headers,method:e.method,params:e.params,ip:e.ip,subURI:m},isNotUsingDCBN:s,preprocessor:a},{notExists:function(){r(_)},error:function(e,t,r,o,i,s,a,u){n(_,e,t,r,o,i,s,a,u)},success:function(e){_(void 0!==e.redirectURL?{statusCode:302,headers:{"Set-Cookie":CREATE_COOKIE_STR_ARRAY(e.cookies),Location:e.redirectURL}}:{headers:{"Set-Cookie":CREATE_COOKIE_STR_ARRAY(e.cookies)},content:void 0===u?e.html:u(e.html),contentType:"text/html"})}})};return NEXT([function(e){""===h?CHECK_IS_EXISTS_FILE(o+"/index.nsp",function(t){h=t===!0?"index.nsp":"index.html",e()}):e()},function(){return function(){d=o+"/"+h,l=t.extname(h).toLowerCase(),".nsp"===l?S():""===l?NEXT([function(e){CHECK_IS_EXISTS_FILE(d+".nsp",function(t){t===!0?CHECK_IS_FOLDER(d+".nsp",function(t){t===!0?e():(d+=".nsp",S())}):e()})},function(e){return function(){void 0!==i?(CHECK_IS_ARRAY(i)===!0?CHECK_IS_IN({array:i,value:h})===!0?h=i+".nsp":EACH(i,function(e){return e+"/"===h.substring(0,e.length+1)?(m=h.substring(e.length+1),h=e+".nsp",!1):void 0}):i===h?h=i+".nsp":i+"/"===h.substring(0,i.length+1)&&(m=h.substring(i.length+1),h=i+".nsp"),CHECK_IS_EXISTS_FILE(o+"/"+h,function(t){t===!0?(d=o+"/"+h,S()):e()})):e()}},function(){return function(){CHECK_IS_EXISTS_FILE(d,function(e){e===!0?CHECK_IS_FOLDER(d,function(e){e===!0?(d+="/index.nsp",S()):p()}):p()})}}]):p()}}]),!1}}}}});